# ライブラリ

この章では、Poetryでライブラリをインストールできるようにする方法を教えます。

## 全てのプロジェクトはパッケージ

`pyproject.toml` をディレクトリに置いたなら、そのディレクトリはもうパッケージになのです。
ただし、他のパッケージからアクセス可能にするには、パッケージ化と公開が必要です。


## バージョン付け

Poetryはパッケージのバージョン付けに関して、どんな慣習も強制することはありませんが、 [semantic
versioning](https://semver.org) に従うことを **強く** 推奨します。

これにはエンドユーザーにとっての多くの利点があり、適切な [バージョン制約](/docs/versions/) が設定できるようになります。

## ロックファイル

ライブラリでは、そうしたくて `poetry.lock` ファイルをコミットするかもしれません。
これは、チームが常に同じバージョンの依存関係に対してテストをするのに役立ちます。
ただし、このロックファイルはライブラリに依存している他のプロジェクトには何の効果もありません。
メインのプロジェクトにのみ効果があります。

ロックファイルをコミットしたくない人がgitを使っているなら、 `.gitignore` に追加してください。

## パッケージ化

ライブラリを実際に公開できるようにする前に、パッケージ化する必要があります。

```bash
poetry build
```


このコマンドはライブラリを2つの異なる形式にパッケージ化します: ソース形式である `sdist` と"コンパイル済み"パッケージである `wheel`
です。

これができたら、ライブラリを公開する準備ができました。

## PyPIへ公開

よし、これでパッケージを公開できるようになりました。

Poetryは、デフォルトでは [PyPI](https://pypi.org) に公開します。
PyPIに公開されたものはなんであれ、必然的にPoetryで取得できます。
[pendulum](https://pypi.org/project/pendulum/)
はPyPIに上がっているので、追加のレポジトリを指定することなく依存できます。

もし `poetry-demo` をPythonコミュニティに共有したかったなら、PyPIにも公開します。
これは本当に簡単なことです。

```bash
poetry publish
```


ユーザー登録を済ませ、適切に [証明書が設定されている](/docs/repositories/#adding-credentials)
という条件が揃っているとき、このコマンドはライブラリをパッケージ化して、PyPIへ公開します。

!!!note

    `publish` コマンドは、デフォルトでは `build` コマンドを実行しません。

    パッケージのビルドも公開も一緒に行って欲しい場合は、
    `--build` オプションを渡してください。

これが済んだら、ライブラリは誰からも取得可能になります。


## プライベートレポジトリへ公開

ライブラリは公開しないでおきたいが、チームには入手可能にしたいときもあります。

その場合は、プライベートレポジトリが必要になります。

プライベートレポジトリに公開するには、レポジトリのリストに追加する必要があります。
より詳しいことは [レポジトリの追加](/docs/repositories/#adding-a-repository) を参照してください。

これが済んだら、次のように実際に公開できます:

```bash
poetry publish -r my-repository
```

